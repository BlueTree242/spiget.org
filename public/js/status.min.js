window.SpigetStatus={options:{icons:{checking:"glyphicon glyphicon-question-sign",up:"glyphicon glyphicon-ok-sign",down:"glyphicon glyphicon-remove-sign"},colors:{checking:"gray",up:"#00b900",down:"red"}},display:{checking:function(t){t.removeClass(),t.css("color",window.SpigetStatus.options.colors.checking),t.addClass(window.SpigetStatus.options.icons.checking)},up:function(t){t.removeClass(),t.css("color",window.SpigetStatus.options.colors.up),t.addClass(window.SpigetStatus.options.icons.up)},down:function(t){t.removeClass(),t.css("color",window.SpigetStatus.options.colors.down),t.addClass(window.SpigetStatus.options.icons.down)}},servers:window.SpigetStatusServers||[],checkServers:function(){var n=0;$.each(window.SpigetStatus.servers,function(t,e){var s=$("<div style='color:darkgray;' class='server'></div>"),a=$("<a href='#' target='_blank'></a>"),o=$("<i style='color:gray;' class='glyphicon'></i>");o.appendTo(a),a.appendTo(s),s.appendTo($("#serverContainer")),s.css("background",e.color),window.SpigetStatus.display.checking(o),a.attr("title",e.name),a.attr("href",e.url),e.apiKey?$.ajax({url:"https://api.uptimerobot.com/getMonitors?format=json&noJsonCallback=1&apiKey="+e.apiKey,dataType:"json",success:function(t){console.log(t),t.monitors.monitor[0].status<=2?(window.SpigetStatus.display.up(o),n++,window.SpigetStatus.refreshGlobalStatus(n)):window.SpigetStatus.display.down(o)},error:function(t,e,s){window.SpigetStatus.display.down(o),console.log(s)}}):(console.warn("Server "+e.name+" does not have an API-Key"),setTimeout(function(){window.SpigetStatus.display.down(o)},Math.floor(1500*Math.random())+500)),e.url&&$.ajax({url:e.url+"/v2/status?callback=?",success:function(t){s.addClass("mode-"+t.status.server.mode)}})})},refreshGlobalStatus:function(t){$("#api-status").text(t+"/"+window.SpigetStatus.servers.length+" servers online"),t>=window.SpigetStatus.servers.length?($("#api-status-panel").removeClass("panel-warning"),$("#api-status-panel").removeClass("panel-danger"),$("#api-status-panel").addClass("panel-success"),$("#api-status").text("All servers online!")):t<=0&&($("#api-status-panel").removeClass("panel-warning"),$("#api-status-panel").addClass("panel-danger"),$("#api-status").text("All servers are offline"))},checkFetcher:function(){$.ajax({url:"https://api.spiget.org/v2/status",success:function(t){t.status.fetch.active?($("#fetcher-status").html("The API is <span class='fetcher-updating'>currently updating</span>"),$("#fetcher-details").html("The update started <span class='time'>"+moment(t.status.fetch.start).fromNow()+"</span>")):($("#fetcher-status").html("The API is <span class='fetcher-updated'>up to date</span>"),$("#fetcher-details").html("It was last updated <span class='time'>"+moment(t.status.fetch.start).fromNow()+"</span>"))}})},drawCharts:function(){var n=function(){var s=[],t=this.points.sort(function(t,e){return t.y>e.y?-1:t.y<e.y?1:0});$.each(t,function(t,e){s.push('<span style="color:'+e.series.color+';">'+e.series.name+"</span>: <strong>"+Highcharts.numberFormat(e.y,-1)+"</strong>")});var e='<span style="font-size:12px" class="text-muted">'+moment(this.x).format("dddd, MMMM Do YYYY - HH:00")+"</span><br/>";return e+=s.join("<br/>")};$.ajax({url:"https://api.spiget.org/v2/metrics/requests/30",success:function(t){console.log(t);var a={total:[],unique:[]},o={Spiget:[]};$.each(t,function(t,e){var s=1e3*e.timestamp;a.total.push([s,e.total]),a.unique.push([s,e.unique]),$.each(e.userAgents,function(t,e){void 0===o[t]&&(o[t]=[]),o[t].push([s,e])})});var e=[{name:"total",color:"black",data:a.total},{name:"unique",color:"blue",visible:!1,data:a.unique},{name:"trend",color:"gray",data:fitData(a.total).data}],s=[];$.each(o,function(t,e){s.push({name:t,data:e})}),$("#daily_requests_graph").highcharts({chart:{type:"spline",zoomType:"x",height:500},legend:{enabled:!0},plotOptions:{series:{marker:{enabled:!1,symbol:"circle",states:{hover:{enabled:!0}}}}},title:{text:"Daily Requests"},xAxis:{type:"datetime"},yAxis:{title:{text:"Number of Requests"}},tooltip:{backgroundColor:{linearGradient:[0,0,0,60],stops:[[0,"#FFFFFF"],[1,"#E0E0E0"]]},crossshairs:[!0,!0],shared:!0,followPointer:!0,followTouchMove:!0,formatter:n,useHTML:!0},series:e}),$("#user_agent_requests_graph").highcharts({chart:{type:"spline",zoomType:"x",height:800},legend:{enabled:!0},plotOptions:{series:{marker:{enabled:!1,symbol:"circle",states:{hover:{enabled:!0}}}}},title:{text:"Requests per User-Agent"},xAxis:{type:"datetime"},yAxis:{title:{text:"Number of Requests"},min:0},tooltip:{backgroundColor:{linearGradient:[0,0,0,60],stops:[[0,"#FFFFFF"],[1,"#E0E0E0"]]},crossshairs:[!0,!0],shared:!0,followPointer:!0,followTouchMove:!0,formatter:n,useHTML:!0},series:s})}})}};