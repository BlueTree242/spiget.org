$(document).ready(function(){function m(a){panel=$("#api-status-panel");var b=$("#api-status"),f=(new Date).getTime();$.ajax({url:c.status,dataType:"jsonp",success:function(a){pingEnd=(new Date).getTime();ping=pingEnd-f;panel.addClass("panel-success");panel.removeClass("panel-warning");b.html("<strong>ONLINE</strong> API is up and reachable, ping: <code>"+ping+"</code> ms");n();r(a);p(a)},error:function(f){panel.addClass("panel-danger");panel.removeClass("panel-warning");b.html("<strong>OFFLINE</strong> Failed to connect to API");
0<a&&setTimeout(function(){m(a-1)},1E4)}})}function n(){function a(b){panel=$("#spigot_status_panel");statusText=$("#spigot_status");panel.addClass("panel-danger");panel.removeClass("panel-warning");statusText.html("<strong>OFFLINE</strong> The API could not reach the Spigot site. Last checked: "+moment.duration(moment(b.time).diff(moment())).humanize()+" ago");var f=(new Date).getTime();$.ajax({url:"https://spigotmc.org",success:function(a){pingEnd=(new Date).getTime();ping=pingEnd-f;panel.addClass("panel-success");
panel.removeClass("panel-warning");statusText.html("<strong>ONLINE</strong> The API wasn't able to rech the Spigot site, but it seems to be online, ping: <code>"+ping+"</code> ms");n();p(a)},error:function(a){}})}$("#spigot_status_collapse").collapse("show");$.ajax({url:c.spigot_status,dataType:"jsonp",success:function(b){b.online?(panel=$("#spigot_status_panel"),statusText=$("#spigot_status"),panel.addClass("panel-success"),panel.removeClass("panel-warning"),statusText.html("<strong>ONLINE</strong>")):
a(b)},error:function(b){a(b)}})}function r(a){$("#fetch_status_collapse").collapse("show");fetch_status_fetching=$("#fetch_status_fetching");fetch_status_lastUpdate_container=$("#fetch_status_lastUpdate_container");fetch_status_lastUpdate=$("#fetch_status_lastUpdate");fetch_status_nextUpdate=$("#fetch_status_nextUpdate");fetch_status_nextUpdate_detail=$("#fetch_status_nextUpdate_detail");fetch_status_done_container=$("#fetch_status_done_container");fetch_status_done=$("#fetch_status_done");fetch_status_done_detail=
$("#fetch_status_done_detail");fetch_status_nextUpdate.click(function(){fetch_status_nextUpdate.hide();fetch_status_nextUpdate_detail.show()});fetch_status_nextUpdate_detail.click(function(){fetch_status_nextUpdate_detail.hide();fetch_status_nextUpdate.show()});fetch_status_done.click(function(){fetch_status_done.hide();fetch_status_done_detail.show()});fetch_status_done_detail.click(function(){fetch_status_done_detail.hide();fetch_status_done.show()});if(a.status.fetch.active){var b=function(){duration=
moment.duration(doneTime.diff(moment()));diffFormatted=duration.humanize();diffFormattedDetailed=duration.format("HH:mm");fetch_status_done.html(diffFormatted);fetch_status_done.attr("title",diffFormattedDetailed);fetch_status_done_detail.html(diffFormattedDetailed);setTimeout(function(){0==diffFormattedDetailed.indexOf("-")&&location.reload();b()},6E4)};fetch_status_fetching.html("currently updating");fetch_status_fetching.addClass("updating");fetch_status_done_container.show();doneTime=moment().add(a.status.fetch.page.amount*
l.page_size*l.seconds_per_resource,"seconds");b()}else{var f=function(){duration=moment.duration(nextTime.diff(moment()));diffFormatted=duration.humanize();diffFormattedDetailed=duration.format("HH:mm:ss");fetch_status_nextUpdate.html(diffFormatted);fetch_status_nextUpdate.attr("title",diffFormattedDetailed);fetch_status_nextUpdate_detail.html(diffFormattedDetailed);setTimeout(function(){0==diffFormattedDetailed.indexOf("-")&&location.reload();f()},1E4)};fetch_status_fetching.html("up to date");fetch_status_fetching.addClass("updated");
fetch_status_lastUpdate_container.show();endDate=moment.unix(a.status.fetch.end/1E3);endDate=endDate.startOf("hour");fetch_status_lastUpdate.html(endDate.format("YYYY-MM-DD HH:mm:ss Z"));nextTime=endDate.add(l.update_interval,"hours");f()}}function p(a){var b=function(){var a=[],b=this.points.sort(function(a,b){return a.y>b.y?-1:a.y<b.y?1:0});$.each(b,function(b,c){a.push('<span style="color:'+c.series.color+';">'+c.series.name+"</span>: <strong>"+Highcharts.numberFormat(c.y,-1)+"</strong>")});b=
'<span style="font-size:12px" class="text-muted">'+moment(this.x).format("dddd, MMMM Do YYYY - HH:00")+"</span><br/>";return b+=a.join("<br/>")};$.ajax({url:c.metrics,dataType:q?"jsonp":"json",success:function(a){var c=[],g=[],h=[];$.each(a,function(a,b){keyName=" "+a.toString()+" ";c[keyName]=b.total;$.each(b.user_agents,function(a,b){void 0==g[a]&&(g[a]=[]);g[a][keyName]=b});$.each(b.methods,function(a,b){a=a.replace("v2/","").replace("v2","");void 0==h[a]&&(h[a]=[]);h[a][keyName]=b})});$("#daily_requests_collapse").collapse("show");
a=[];for(var d in c)value=c[d],d=parseInt(d.trim()),0<value&&(date=1E3*d,a.push([date,value]));$("#daily_requests_graph").highcharts({chart:{type:"spline",zoomType:"x"},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1,symbol:"circle",states:{hover:{enabled:!0}}}}},title:{text:"Daily Requests"},xAxis:{type:"datetime"},yAxis:{title:{text:"Number of Requests"}},tooltip:{backgroundColor:{linearGradient:[0,0,0,60],stops:[[0,"#FFFFFF"],[1,"#E0E0E0"]]},crossshairs:[!0,!0],shared:!0,followPointer:!0,
followTouchMove:!0,formatter:b,useHTML:!0},series:[{name:"total",data:a},{name:"average",data:fitData(a).data}]});$("#user_agent_requests_collapse").collapse("show");a=[];for(d in g){value=g[d];var k=[],e;for(e in value)value1=value[e],e=parseInt(e.trim()),date=1E3*e,k.push([date,value1]);a.push({name:d,data:k})}$("#user_agent_requests_graph").highcharts({chart:{type:"spline",zoomType:"x"},legend:{enabled:"true"===Cookies.get("enableLegend")},plotOptions:{series:{marker:{enabled:!1,symbol:"circle",
states:{hover:{enabled:!0}}}}},title:{text:"Requests per User-Agent"},xAxis:{type:"datetime"},yAxis:{title:{text:"Number of Requests"},min:0},tooltip:{backgroundColor:{linearGradient:[0,0,0,60],stops:[[0,"#FFFFFF"],[1,"#E0E0E0"]]},crossshairs:[!0,!0],shared:!0,followPointer:!0,followTouchMove:!0,formatter:b,useHTML:!0},series:a});$("#method_requests_collapse").collapse("show");a=[];for(d in h){value=h[d];k=[];for(e in value)value1=value[e],e=parseInt(e.trim()),date=1E3*e,k.push([date,value1]);a.push({name:d,
data:k})}$("#method_requests_graph").highcharts({chart:{type:"spline",zoomType:"x"},legend:{enabled:"true"===Cookies.get("enableLegend")},plotOptions:{series:{marker:{enabled:!1,symbol:"circle",states:{hover:{enabled:!0}}}}},title:{text:"Requests per Method"},xAxis:{type:"datetime"},yAxis:{title:{text:"Number of Requests"},min:0},tooltip:{backgroundColor:{linearGradient:[0,0,0,60],stops:[[0,"#FFFFFF"],[1,"#E0E0E0"]]},crossshairs:[!0,!0],shared:!0,followPointer:!0,followTouchMove:!0,formatter:b,useHTML:!0},
series:a})}})}var a=Cookies.get("statsApiVersion");void 0===a&&(a="v2");$("#api_version_selector").val(a);var c={status:"https://api.spiget.org/v2/status?spiget___ua=SpigetStatus&callback=?",spigot_status:"https://api.spiget.org/spigotStatus.php?spiget___ua=SpigetStatus&callback=?",metrics:"https://api.spiget.org/"+a+"/metrics/requests/30?spiget___ua=SpigetStatus&pretty=false"},l={page_size:20,seconds_per_resource:20,update_interval:2},a=Cookies.get("showFullUserAgent");if(void 0===a||"true"!==a)c.metrics+=
"&stripUaVersion=true";a=Cookies.get("hourlyRequests");void 0!==a&&"true"===a&&(c.metrics+="&hourly");var a=Cookies.get("forceLiveData"),q=!1;void 0!==a&&"true"===a&&(c.metrics+="&callback=?",q=!0);$("#api_version_selector").change(function(){Cookies.set("statsApiVersion",$(this).val(),{expires:356});location.reload()});m(2);$("#user_agent_graph_expand").click(function(a){a.preventDefault();$("#user_agent_requests_graph").highcharts().setSize($($("#user_agent_requests_graph").highcharts().container).width(),
1E3)})});
